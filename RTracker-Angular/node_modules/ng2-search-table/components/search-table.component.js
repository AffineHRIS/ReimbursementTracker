"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var search_table_service_1 = require("../services/search-table.service");
var no_header_component_1 = require("./header/no-header.component");
var no_filter_component_1 = require("./table-filter/no-filter.component");
var ng2_search_table_1 = require('../ng2-search-table');
var SearchTableComponent = (function () {
    function SearchTableComponent(componentResolver, searchTableService, compiler) {
        this.componentResolver = componentResolver;
        this.searchTableService = searchTableService;
        this.compiler = compiler;
        this.config = {};
        this.dataRows = [];
        this.headerComponents = [];
        this.sortCondition = {};
        this.filterConditions = {};
        this.currentPage = 1;
        this.pagePer = 20;
        this.totalCount = 0;
        this.debounceTime = 200; /* ms */
        this.headerInstances = {};
        this.filterInstances = {};
        this.defaultValues = {};
        this.visibilities = {};
    }
    SearchTableComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.debounceSearchEventEmitter = new core_1.EventEmitter();
        this.debounceSearchEventEmitter
            .debounceTime(this.debounceTime)
            .subscribe(function (_) { return _this.search(); });
        this.parseConfig(this.config);
        this.columns.forEach(function (header) {
            var headerComponent = header.headerComponent || no_header_component_1.NoHeaderComponent;
            _this.compiler.compileModuleAndAllComponentsAsync(ng2_search_table_1.Ng2SearchTableModule).then(function (moduleFactory) {
                var factory = moduleFactory.componentFactories.find(function (x) { return x.componentType == headerComponent; });
                var c = _this.createHeaderTableComponent(factory, header, _this.headerViewComponents);
                _this.headerInstances[header.name] = c.instance;
            });
            var filterComponent = header.filterComponent || no_filter_component_1.NoFilterComponent;
            _this.compiler.compileModuleAndAllComponentsAsync(ng2_search_table_1.Ng2SearchTableModule).then(function (moduleFactory) {
                var factory = moduleFactory.componentFactories.find(function (x) { return x.componentType == filterComponent; });
                var c = _this.createFilterTableComponent(factory, header, _this.headerFilterComponents);
                _this.filterInstances[header.name] = c.instance;
            });
        });
    };
    SearchTableComponent.prototype.getCurrentPage = function () {
        return this.currentPage;
    };
    SearchTableComponent.prototype.getPagePer = function () {
        return this.pagePer;
    };
    SearchTableComponent.prototype.getTotalCount = function () {
        return this.totalCount;
    };
    SearchTableComponent.prototype.setCurrentPage = function (page) {
        this.currentPage = page;
        this.search();
    };
    SearchTableComponent.prototype.setPagePer = function (per) {
        this.pagePer = per;
        this.setCurrentPage(1);
    };
    SearchTableComponent.prototype.search = function () {
        var _this = this;
        var searchParams = {
            page: this.getCurrentPage(),
            per: this.getPagePer(),
            sort: this.sortCondition,
            filter: this.filterConditions
        };
        this
            .searchTableService
            .search(this.config.url, searchParams)
            .subscribe(function (r) {
            _this.setTotalCount(r.totalCount);
            _this.dataRows = r.results;
        });
    };
    SearchTableComponent.prototype.setSortDirection = function (name, direction) {
        this.sortCondition = {};
        this.sortCondition[name] = direction;
        this.clearHeaderSortDirection(name);
    };
    SearchTableComponent.prototype.setFilterValue = function (name, value, subComponentName) {
        var instance = this.filterInstances[name];
        if (instance) {
            if (subComponentName) {
                instance.setValue(subComponentName, value);
            }
            else {
                instance.setValue(name, value);
            }
        }
        this.defaultValues[name] = { value: value, subComponentName: subComponentName };
        this.resetCurrentPage();
    };
    SearchTableComponent.prototype.setVisibility = function (name, visible) {
        if (this.headerInstances[name]) {
            this.headerInstances[name].setVisibility(visible);
        }
        if (this.filterInstances[name]) {
            this.filterInstances[name].setVisibility(visible);
        }
        this.visibilities[name] = visible;
    };
    SearchTableComponent.prototype.parseConfig = function (config) {
        if (config.defaultPagePer) {
            this.pagePer = config.defaultPagePer;
        }
    };
    SearchTableComponent.prototype.setTotalCount = function (count) {
        this.totalCount = count;
    };
    SearchTableComponent.prototype.resetCurrentPage = function () {
        this.currentPage = 1;
    };
    SearchTableComponent.prototype.createHeaderTableComponent = function (factory, header, viewComponents) {
        var _this = this;
        var c = viewComponents.createComponent(factory);
        c.instance.name = header.name;
        c.instance.model = header.model;
        c.instance.eventEmitter.subscribe(function (v) {
            _this.setSortDirection(v.name, v.value);
            _this.search();
        });
        if (this.sortCondition[header.name]) {
            c.instance.model.direction = this.sortCondition[header.name];
        }
        if (this.visibilities[header.name] !== true && this.visibilities[header.name] !== false) {
            this.visibilities[header.name] = true;
        }
        c.instance.setVisibility(this.visibilities[header.name]);
        return c;
    };
    SearchTableComponent.prototype.createFilterTableComponent = function (factory, header, viewComponents) {
        var _this = this;
        var c = viewComponents.createComponent(factory);
        c.instance.name = header.name;
        c.instance.model = header.model;
        c.instance.eventEmitter.subscribe(function (v) {
            _this.filterConditions[v.name] = v.value;
            _this.resetCurrentPage();
            _this.debounceSearchEventEmitter.emit(true);
        });
        var defaultValue = this.defaultValues[header.name];
        if (defaultValue) {
            if (defaultValue.subComponentName) {
                c.instance.setValue(defaultValue.subComponentName, defaultValue.value);
            }
            else {
                c.instance.setValue(header.name, defaultValue.value);
            }
        }
        if (this.visibilities[header.name] !== true && this.visibilities[header.name] !== false) {
            this.visibilities[header.name] = true;
        }
        c.instance.setVisibility(this.visibilities[header.name]);
        return c;
    };
    SearchTableComponent.prototype.clearHeaderSortDirection = function (without) {
        var _this = this;
        if (this.columns) {
            this.columns.forEach(function (v) {
                if (v.name !== without) {
                    _this.headerInstances[v.name].model.direction = "";
                }
            });
        }
    };
    __decorate([
        core_1.ViewChild("headerViewComponents", { read: core_1.ViewContainerRef }), 
        __metadata('design:type', Object)
    ], SearchTableComponent.prototype, "headerViewComponents", void 0);
    __decorate([
        core_1.ViewChild("headerFilterComponents", { read: core_1.ViewContainerRef }), 
        __metadata('design:type', Object)
    ], SearchTableComponent.prototype, "headerFilterComponents", void 0);
    SearchTableComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: "search-table",
            inputs: [
                "tableClass",
                "columns",
                "config"
            ],
            template: "\n  <table [ngClass]=\"tableClass\">\n    <thead>\n      <tr>\n        <template #headerViewComponents></template>\n      </tr>\n      <tr>\n        <template #headerFilterComponents></template>\n      </tr>\n    </thead>\n    <ng-content></ng-content>\n  </table>\n  "
        }), 
        __metadata('design:paramtypes', [core_1.ComponentFactoryResolver, search_table_service_1.SearchTableService, core_1.Compiler])
    ], SearchTableComponent);
    return SearchTableComponent;
}());
exports.SearchTableComponent = SearchTableComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLXRhYmxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNlYXJjaC10YWJsZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLHFCQUlPLGVBQWUsQ0FBQyxDQUFBO0FBQ3ZCLHFDQUFpQyxrQ0FBa0MsQ0FBQyxDQUFBO0FBQ3BFLG9DQUFnQyw4QkFBOEIsQ0FBQyxDQUFBO0FBQy9ELG9DQUFnQyxvQ0FBb0MsQ0FBQyxDQUFBO0FBQ3JFLGlDQUFtQyxxQkFBcUIsQ0FBQyxDQUFBO0FBeUJ6RDtJQXlCRSw4QkFDVSxpQkFBMkMsRUFDM0Msa0JBQXNDLEVBQ3RDLFFBQWtCO1FBRmxCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBMEI7UUFDM0MsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUN0QyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBdEI1QixXQUFNLEdBQVEsRUFBRSxDQUFDO1FBRVYsYUFBUSxHQUFVLEVBQUUsQ0FBQztRQUNyQixxQkFBZ0IsR0FBVSxFQUFFLENBQUM7UUFDNUIsa0JBQWEsR0FBUSxFQUFFLENBQUM7UUFDeEIscUJBQWdCLEdBQVEsRUFBRSxDQUFDO1FBRTNCLGdCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBQ3hCLFlBQU8sR0FBVyxFQUFFLENBQUM7UUFDckIsZUFBVSxHQUFXLENBQUMsQ0FBQztRQUd2QixpQkFBWSxHQUFXLEdBQUcsQ0FBQyxDQUFDLFFBQVE7UUFFcEMsb0JBQWUsR0FBUSxFQUFFLENBQUM7UUFDMUIsb0JBQWUsR0FBUSxFQUFFLENBQUM7UUFDMUIsa0JBQWEsR0FBUSxFQUFFLENBQUM7UUFDeEIsaUJBQVksR0FBUSxFQUFFLENBQUM7SUFNNUIsQ0FBQztJQUVKLHVDQUFRLEdBQVI7UUFBQSxpQkFzQkM7UUFyQkMsSUFBSSxDQUFDLDBCQUEwQixHQUFHLElBQUksbUJBQVksRUFBTyxDQUFDO1FBQzFELElBQUksQ0FBQywwQkFBMEI7YUFDNUIs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UEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBQyxDQUFNO2dCQUMxQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUM7b0JBQ3ZCLEtBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO2dCQUNwRCxDQUFDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQztJQXpMRDtRQUFDLGdCQUFTLENBQUMsc0JBQXNCLEVBQUUsRUFBQyxJQUFJLEVBQUUsdUJBQWdCLEVBQUMsQ0FBQzs7c0VBQUE7SUFDNUQ7UUFBQyxnQkFBUyxDQUFDLHdCQUF3QixFQUFFLEVBQUMsSUFBSSxFQUFFLHVCQUFnQixFQUFDLENBQUM7O3dFQUFBO0lBekJoRTtRQUFDLGdCQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDbkIsUUFBUSxFQUFFLGNBQWM7WUFDeEIsTUFBTSxFQUFFO2dCQUNOLFlBQVk7Z0JBQ1osU0FBUztnQkFDVCxRQUFRO2FBQ1Q7WUFDRCxRQUFRLEVBQUUsOFFBWVQ7U0FDRixDQUFDOzs0QkFBQTtJQTZMRiwyQkFBQztBQUFELENBQUMsQUEzTEQsSUEyTEM7QUEzTFksNEJBQW9CLHVCQTJMaEMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q29udGFpbmVyUmVmLFxuICBWaWV3Q2hpbGQsIENvbXBpbGVyLCBFdmVudEVtaXR0ZXIsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtTZWFyY2hUYWJsZVNlcnZpY2V9IGZyb20gXCIuLi9zZXJ2aWNlcy9zZWFyY2gtdGFibGUuc2VydmljZVwiO1xuaW1wb3J0IHtOb0hlYWRlckNvbXBvbmVudH0gZnJvbSBcIi4vaGVhZGVyL25vLWhlYWRlci5jb21wb25lbnRcIjtcbmltcG9ydCB7Tm9GaWx0ZXJDb21wb25lbnR9IGZyb20gXCIuL3RhYmxlLWZpbHRlci9uby1maWx0ZXIuY29tcG9uZW50XCI7XG5pbXBvcnQge05nMlNlYXJjaFRhYmxlTW9kdWxlfSBmcm9tICcuLi9uZzItc2VhcmNoLXRhYmxlJztcblxuQENvbXBvbmVudCh7XG4gIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gIHNlbGVjdG9yOiBcInNlYXJjaC10YWJsZVwiLFxuICBpbnB1dHM6IFtcbiAgICBcInRhYmxlQ2xhc3NcIixcbiAgICBcImNvbHVtbnNcIixcbiAgICBcImNvbmZpZ1wiXG4gIF0sXG4gIHRlbXBsYXRlOiBgXG4gIDx0YWJsZSBbbmdDbGFzc109XCJ0YWJsZUNsYXNzXCI+XG4gICAgPHRoZWFkPlxuICAgICAgPHRyPlxuICAgICAgICA8dGVtcGxhdGUgI2hlYWRlclZpZXdDb21wb25lbnRzPjwvdGVtcGxhdGU+XG4gICAgICA8L3RyPlxuICAgICAgPHRyPlxuICAgICAgICA8dGVtcGxhdGUgI2hlYWRlckZpbHRlckNvbXBvbmVudHM+PC90ZW1wbGF0ZT5cbiAgICAgIDwvdHI+XG4gICAgPC90aGVhZD5cbiAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gIDwvdGFibGU+XG4gIGBcbn0pXG5cbmV4cG9ydCBjbGFzcyBTZWFyY2hUYWJsZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBWaWV3Q2hpbGQoXCJoZWFkZXJWaWV3Q29tcG9uZW50c1wiLCB7cmVhZDogVmlld0NvbnRhaW5lclJlZn0pIGhlYWRlclZpZXdDb21wb25lbnRzOiBhbnk7XG4gIEBWaWV3Q2hpbGQoXCJoZWFkZXJGaWx0ZXJDb21wb25lbnRzXCIsIHtyZWFkOiBWaWV3Q29udGFpbmVyUmVmfSkgaGVhZGVyRmlsdGVyQ29tcG9uZW50czogYW55O1xuXG4gIHRhYmxlQ2xhc3M6IHN0cmluZztcbiAgY29sdW1uczogYW55W107XG4gIGNvbmZpZzogYW55ID0ge307XG5cbiAgcHVibGljIGRhdGFSb3dzOiBhbnlbXSA9IFtdO1xuICBwdWJsaWMgaGVhZGVyQ29tcG9uZW50czogYW55W10gPSBbXTtcbiAgcHJpdmF0ZSBzb3J0Q29uZGl0aW9uOiBhbnkgPSB7fTtcbiAgcHJpdmF0ZSBmaWx0ZXJDb25kaXRpb25zOiBhbnkgPSB7fTtcblxuICBwcml2YXRlIGN1cnJlbnRQYWdlOiBudW1iZXIgPSAxO1xuICBwcml2YXRlIHBhZ2VQZXI6IG51bWJlciA9IDIwO1xuICBwcml2YXRlIHRvdGFsQ291bnQ6IG51bWJlciA9IDA7XG5cbiAgcHJpdmF0ZSBkZWJvdW5jZVNlYXJjaEV2ZW50RW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT47XG4gIHByaXZhdGUgZGVib3VuY2VUaW1lOiBudW1iZXIgPSAyMDA7IC8qIG1zICovXG5cbiAgcHJpdmF0ZSBoZWFkZXJJbnN0YW5jZXM6IGFueSA9IHt9O1xuICBwcml2YXRlIGZpbHRlckluc3RhbmNlczogYW55ID0ge307XG4gIHByaXZhdGUgZGVmYXVsdFZhbHVlczogYW55ID0ge307XG4gIHByaXZhdGUgdmlzaWJpbGl0aWVzOiBhbnkgPSB7fTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGNvbXBvbmVudFJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHJpdmF0ZSBzZWFyY2hUYWJsZVNlcnZpY2U6IFNlYXJjaFRhYmxlU2VydmljZSxcbiAgICBwcml2YXRlIGNvbXBpbGVyOiBDb21waWxlclxuICApIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5kZWJvdW5jZVNlYXJjaEV2ZW50RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIHRoaXMuZGVib3VuY2VTZWFyY2hFdmVudEVtaXR0ZXJcbiAgICAgIC5kZWJvdW5jZVRpbWUodGhpcy5kZWJvdW5jZVRpbWUpXG4gICAgICAuc3Vic2NyaWJlKChfOiBhbnkpID0+IHRoaXMuc2VhcmNoKCkpO1xuXG4gICAgdGhpcy5wYXJzZUNvbmZpZyh0aGlzLmNvbmZpZyk7XG4gICAgdGhpcy5jb2x1bW5zLmZvckVhY2goaGVhZGVyID0+IHtcbiAgICAgIGxldCBoZWFkZXJDb21wb25lbnQgPSBoZWFkZXIuaGVhZGVyQ29tcG9uZW50IHx8IE5vSGVhZGVyQ29tcG9uZW50O1xuICAgICAgdGhpcy5jb21waWxlci5jb21waWxlTW9kdWxlQW5kQWxsQ29tcG9uZW50c0FzeW5jKE5nMlNlYXJjaFRhYmxlTW9kdWxlKS50aGVuKChtb2R1bGVGYWN0b3J5KSA9PiB7XG4gICAgICAgIGxldCBmYWN0b3J5ID0gbW9kdWxlRmFjdG9yeS5jb21wb25lbnRGYWN0b3JpZXMuZmluZCh4ID0+IHguY29tcG9uZW50VHlwZSA9PSBoZWFkZXJDb21wb25lbnQpO1xuICAgICAgICBsZXQgYzogYW55ID0gdGhpcy5jcmVhdGVIZWFkZXJUYWJsZUNvbXBvbmVudChmYWN0b3J5LCBoZWFkZXIsIHRoaXMuaGVhZGVyVmlld0NvbXBvbmVudHMpO1xuICAgICAgICB0aGlzLmhlYWRlckluc3RhbmNlc1toZWFkZXIubmFtZV0gPSBjLmluc3RhbmNlO1xuICAgICAgfSk7XG5cbiAgICAgIGxldCBmaWx0ZXJDb21wb25lbnQgPSBoZWFkZXIuZmlsdGVyQ29tcG9uZW50IHx8IE5vRmlsdGVyQ29tcG9uZW50O1xuICAgICAgdGhpcy5jb21waWxlci5jb21waWxlTW9kdWxlQW5kQWxsQ29tcG9uZW50c0FzeW5jKE5nMlNlYXJjaFRhYmxlTW9kdWxlKS50aGVuKChtb2R1bGVGYWN0b3J5KSA9PiB7XG4gICAgICAgIGxldCBmYWN0b3J5ID0gbW9kdWxlRmFjdG9yeS5jb21wb25lbnRGYWN0b3JpZXMuZmluZCh4ID0+IHguY29tcG9uZW50VHlwZSA9PSBmaWx0ZXJDb21wb25lbnQpO1xuICAgICAgICBsZXQgYzogYW55ID0gdGhpcy5jcmVhdGVGaWx0ZXJUYWJsZUNvbXBvbmVudChmYWN0b3J5LCBoZWFkZXIsIHRoaXMuaGVhZGVyRmlsdGVyQ29tcG9uZW50cyk7XG4gICAgICAgIHRoaXMuZmlsdGVySW5zdGFuY2VzW2hlYWRlci5uYW1lXSA9IGMuaW5zdGFuY2U7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEN1cnJlbnRQYWdlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFBhZ2U7XG4gIH1cblxuICBnZXRQYWdlUGVyKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucGFnZVBlcjtcbiAgfVxuXG4gIGdldFRvdGFsQ291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy50b3RhbENvdW50O1xuICB9XG5cbiAgc2V0Q3VycmVudFBhZ2UocGFnZTogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5jdXJyZW50UGFnZSA9IHBhZ2U7XG4gICAgdGhpcy5zZWFyY2goKTtcbiAgfVxuXG4gIHNldFBhZ2VQZXIocGVyOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnBhZ2VQZXIgPSBwZXI7XG4gICAgdGhpcy5zZXRDdXJyZW50UGFnZSgxKTtcbiAgfVxuXG4gIHNlYXJjaCgpOiB2b2lkIHtcbiAgICBsZXQgc2VhcmNoUGFyYW1zID0ge1xuICAgICAgcGFnZTogdGhpcy5nZXRDdXJyZW50UGFnZSgpLFxuICAgICAgcGVyOiB0aGlzLmdldFBhZ2VQZXIoKSxcbiAgICAgIHNvcnQ6IHRoaXMuc29ydENvbmRpdGlvbixcbiAgICAgIGZpbHRlcjogdGhpcy5maWx0ZXJDb25kaXRpb25zXG4gICAgfTtcbiAgICB0aGlzXG4gICAgICAuc2VhcmNoVGFibGVTZXJ2aWNlXG4gICAgICAuc2VhcmNoKHRoaXMuY29uZmlnLnVybCwgc2VhcmNoUGFyYW1zKVxuICAgICAgLnN1YnNjcmliZSgocjogYW55KSA9PiB7XG4gICAgICAgIHRoaXMuc2V0VG90YWxDb3VudChyLnRvdGFsQ291bnQpO1xuICAgICAgICB0aGlzLmRhdGFSb3dzID0gci5yZXN1bHRzO1xuICAgICAgfSk7XG4gIH1cblxuICBzZXRTb3J0RGlyZWN0aW9uKG5hbWU6IHN0cmluZywgZGlyZWN0aW9uOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnNvcnRDb25kaXRpb24gPSB7fTtcbiAgICB0aGlzLnNvcnRDb25kaXRpb25bbmFtZV0gPSBkaXJlY3Rpb247XG4gICAgdGhpcy5jbGVhckhlYWRlclNvcnREaXJlY3Rpb24obmFtZSk7XG4gIH1cblxuICBzZXRGaWx0ZXJWYWx1ZShuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnksIHN1YkNvbXBvbmVudE5hbWU/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBsZXQgaW5zdGFuY2UgPSB0aGlzLmZpbHRlckluc3RhbmNlc1tuYW1lXTtcbiAgICBpZiAoaW5zdGFuY2UpIHtcbiAgICAgIGlmIChzdWJDb21wb25lbnROYW1lKSB7XG4gICAgICAgIGluc3RhbmNlLnNldFZhbHVlKHN1YkNvbXBvbmVudE5hbWUsIHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGluc3RhbmNlLnNldFZhbHVlKG5hbWUsIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5kZWZhdWx0VmFsdWVzW25hbWVdID0geyB2YWx1ZTogdmFsdWUsIHN1YkNvbXBvbmVudE5hbWU6IHN1YkNvbXBvbmVudE5hbWUgfTtcbiAgICB0aGlzLnJlc2V0Q3VycmVudFBhZ2UoKTtcbiAgfVxuXG4gIHNldFZpc2liaWxpdHkobmFtZTogc3RyaW5nLCB2aXNpYmxlOiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGVhZGVySW5zdGFuY2VzW25hbWVdKSB7XG4gICAgICB0aGlzLmhlYWRlckluc3RhbmNlc1tuYW1lXS5zZXRWaXNpYmlsaXR5KHZpc2libGUpO1xuICAgIH1cbiAgICBpZiAodGhpcy5maWx0ZXJJbnN0YW5jZXNbbmFtZV0pIHtcbiAgICAgIHRoaXMuZmlsdGVySW5zdGFuY2VzW25hbWVdLnNldFZpc2liaWxpdHkodmlzaWJsZSk7XG4gICAgfVxuICAgIHRoaXMudmlzaWJpbGl0aWVzW25hbWVdID0gdmlzaWJsZTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VDb25maWcoY29uZmlnOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAoY29uZmlnLmRlZmF1bHRQYWdlUGVyKSB7XG4gICAgICB0aGlzLnBhZ2VQZXIgPSBjb25maWcuZGVmYXVsdFBhZ2VQZXI7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRUb3RhbENvdW50KGNvdW50OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnRvdGFsQ291bnQgPSBjb3VudDtcbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRDdXJyZW50UGFnZSgpOiB2b2lkIHtcbiAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlSGVhZGVyVGFibGVDb21wb25lbnQoZmFjdG9yeTogYW55LCBoZWFkZXI6IGFueSwgdmlld0NvbXBvbmVudHM6IGFueSk6IGFueSB7XG4gICAgbGV0IGM6IGFueSA9IHZpZXdDb21wb25lbnRzLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcbiAgICBjLmluc3RhbmNlLm5hbWUgPSBoZWFkZXIubmFtZTtcbiAgICBjLmluc3RhbmNlLm1vZGVsID0gaGVhZGVyLm1vZGVsO1xuICAgIGMuaW5zdGFuY2UuZXZlbnRFbWl0dGVyLnN1YnNjcmliZSgodjogYW55KSA9PiB7XG4gICAgICB0aGlzLnNldFNvcnREaXJlY3Rpb24odi5uYW1lLCB2LnZhbHVlKTtcbiAgICAgIHRoaXMuc2VhcmNoKCk7XG4gICAgfSk7XG4gICAgaWYgKHRoaXMuc29ydENvbmRpdGlvbltoZWFkZXIubmFtZV0pIHtcbiAgICAgIGMuaW5zdGFuY2UubW9kZWwuZGlyZWN0aW9uID0gdGhpcy5zb3J0Q29uZGl0aW9uW2hlYWRlci5uYW1lXTtcbiAgICB9XG4gICAgaWYgKHRoaXMudmlzaWJpbGl0aWVzW2hlYWRlci5uYW1lXSAhPT0gdHJ1ZSAmJiB0aGlzLnZpc2liaWxpdGllc1toZWFkZXIubmFtZV0gIT09IGZhbHNlKSB7XG4gICAgICB0aGlzLnZpc2liaWxpdGllc1toZWFkZXIubmFtZV0gPSB0cnVlO1xuICAgIH1cbiAgICBjLmluc3RhbmNlLnNldFZpc2liaWxpdHkodGhpcy52aXNpYmlsaXRpZXNbaGVhZGVyLm5hbWVdKTtcbiAgICByZXR1cm4gYztcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRmlsdGVyVGFibGVDb21wb25lbnQoZmFjdG9yeTogYW55LCBoZWFkZXI6IGFueSwgdmlld0NvbXBvbmVudHM6IGFueSk6IGFueSB7XG4gICAgbGV0IGM6IGFueSA9IHZpZXdDb21wb25lbnRzLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcbiAgICBjLmluc3RhbmNlLm5hbWUgPSBoZWFkZXIubmFtZTtcbiAgICBjLmluc3RhbmNlLm1vZGVsID0gaGVhZGVyLm1vZGVsO1xuICAgIGMuaW5zdGFuY2UuZXZlbnRFbWl0dGVyLnN1YnNjcmliZSgodjogYW55KSA9PiB7XG4gICAgICB0aGlzLmZpbHRlckNvbmRpdGlvbnNbdi5uYW1lXSA9IHYudmFsdWU7XG4gICAgICB0aGlzLnJlc2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgIHRoaXMuZGVib3VuY2VTZWFyY2hFdmVudEVtaXR0ZXIuZW1pdCh0cnVlKTtcbiAgICB9KTtcbiAgICBsZXQgZGVmYXVsdFZhbHVlOiBhbnkgPSB0aGlzLmRlZmF1bHRWYWx1ZXNbaGVhZGVyLm5hbWVdO1xuICAgIGlmIChkZWZhdWx0VmFsdWUpIHtcbiAgICAgIGlmIChkZWZhdWx0VmFsdWUuc3ViQ29tcG9uZW50TmFtZSkge1xuICAgICAgICBjLmluc3RhbmNlLnNldFZhbHVlKGRlZmF1bHRWYWx1ZS5zdWJDb21wb25lbnROYW1lLCBkZWZhdWx0VmFsdWUudmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYy5pbnN0YW5jZS5zZXRWYWx1ZShoZWFkZXIubmFtZSwgZGVmYXVsdFZhbHVlLnZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMudmlzaWJpbGl0aWVzW2hlYWRlci5uYW1lXSAhPT0gdHJ1ZSAmJiB0aGlzLnZpc2liaWxpdGllc1toZWFkZXIubmFtZV0gIT09IGZhbHNlKSB7XG4gICAgICB0aGlzLnZpc2liaWxpdGllc1toZWFkZXIubmFtZV0gPSB0cnVlO1xuICAgIH1cbiAgICBjLmluc3RhbmNlLnNldFZpc2liaWxpdHkodGhpcy52aXNpYmlsaXRpZXNbaGVhZGVyLm5hbWVdKTtcbiAgICByZXR1cm4gYztcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJIZWFkZXJTb3J0RGlyZWN0aW9uKHdpdGhvdXQ/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb2x1bW5zKSB7XG4gICAgICB0aGlzLmNvbHVtbnMuZm9yRWFjaCgodjogYW55KSA9PiB7XG4gICAgICAgIGlmICh2Lm5hbWUgIT09IHdpdGhvdXQpIHtcbiAgICAgICAgICB0aGlzLmhlYWRlckluc3RhbmNlc1t2Lm5hbWVdLm1vZGVsLmRpcmVjdGlvbiA9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19